<!DOCTYPE html>

<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Caphpe</title>

        <link rel="stylesheet" href="style.css" type="text/css">

        <script type=text/javascript>
            if (
                window.location.protocol !== 'https' &&
                window.location.hostname.indexOf('localhost') === -1
            ) {
                window.location = 'https://' + window.location.host;
            }
        </script>

    </head>

    <body>

        <h1 id="caphpe">Caphpe</h1>
        <p>A volatile in-memory key-value storage written in PHP.</p>

        <div class="toc">
            <ol>
                <li><a href="#about">About</a></li>
                <li><a href="#installation">Installation</a>
                    <ol>
                        <li><a href="#installation/requirements">Requirements</a></li>
                        <li><a href="#installation/download">Download</a></li>
                    </ol>
                </li>
                <li><a href="#running-caphpe">Running Caphpe</a>
                    <ol>
                        <li><a href="#running-caphpe/options">Options</a></li>
                    </ol>
                </li>
                <li><a href="#connecting">Connecting</a></li>
                <li><a href="#types-and-data">Types and data</a>
                    <ol>
                        <li><a href="#types-and-data/keys">Keys</a></li>
                        <li><a href="#types-and-data/types">Types</a></li>
                        <li><a href="#types-and-data/values">Values</a></li>
                        <li><a href="#types-and-data/timeouts">Timeouts</a></li>
                    </ol>
                </li>
                <li><a href="#managing-data">Managing data</a>
                    <ol>
                        <li><a href="#managing-data/commands">Commands</a></li>
                    </ol>
                </li>
                <li><a href="#issues-errors-bugs">Issues, errors and bugs</a>
                    <ol>
                        <li><a href="#issues-errors-bugs/known-issues">Known issues</a></li>
                    </ol>
                </li>
            </ol>
        </div>

        <h2 id="about">About</h2>

        <div class="warning">
            <p>
                Caphpe is currently in development. No stable release is available
                yet. This documentation refers to the latest available release.
            </p>
            <p>
                You can follow development and contribute at the
                <a href="https://github.com/rask/caphpe">GitHub source
                repository</a>.
            </p>
        </div>

        <p>
            Caphpe originally started as an experiment on creating a Memcached
            <q>clone</q> of sorts in pure PHP.
        </p>

        <p>
            Caphpe has various commands to store, alter, fetch and delete values.
            It does not persist the cached values anywhere. If you kill the process
            the data is gone for good.
        </p>

        <p>
            Caphpe is not meant to be used as a direct replacement of something like
            Redis or Memcached. They play in an entirely other league when it comes
            to caching software. Caphpe is good for light use small object storage.
            PHP ain't as performant as C either, so it can be slower than Memcached
            and the like. Preliminary benchmarks clocked around 10000 writes per
            second through a persistent socket connection.
        </p>

        <p>
            Read more about Caphpe or browse the code over at the
            <a href="https://github.com/rask/caphpe">GitHub repository</a>.
        </p>

        <h2 id="installation">Installation</h2>

        <h3 id="installation/requirements">Requirements</h3>
        <p>
            Caphpe should work anywhere where a relatively new (5.5+) PHP CLI
            installation is available and where socket creation is allowed.
        </p>

        <p>
            Caphpe has been tested on Linux and Windows.
        </p>

        <h3 id="installation/download">Download</h3>
        <p>
            <a href="caphpe.phar">Download the Phar</a> and move it somewhere
            convenient for now (maybe your <code>$PATH</code>).
        </p>

        <h2 id="running-caphpe">Running Caphpe</h2>

        <p>
            Make sure the downloaded Phar is executable using
        </p>

        <pre><code>
$ chmod +x caphpe.phar
        </code></pre>

        <p>
            You can make it easier to invoke by using
        </p>

        <pre><code>
$ mv caphpe.phar caphpe
        </code></pre>

        <p>
            Then you can run Caphpe as such
        </p>

        <pre><code>
$ caphpe
        </code></pre>

        <h3 id="running-caphpe/options">Options</h3>

        <p>
            Cache offers a few options to alter how it runs:
        </p>

        <pre><code>
--host=[host]|-h [host]
    Define a hostname to listen on. Defaults to 127.0.0.1.

--port=[port]|-p [port]
    Define the port to listen on. Defaults to 10808.

--memorylimit=[limit]|-m [limit]
    Define a memory limit (in megabytes) for Caphpe to use. Defaults to 64MB.

--verbosity=[verbosity]|-v [verbosity]
    Define output verbosity. 1, 2 or 3. Higher means more messages. Defaults to 1.
        </code></pre>

        <p>
            Example:
        </p>

        <pre><code>
$ caphpe \
    --host=192.168.0.123 \
    --port=12345 \
    --memorylimit=128 \
    --verbosity=3
        </code></pre>

        <h2 id="connecting">Connecting to Caphpe</h2>

        <p>
            Caphpe listens on the host and port as defined by the given options
            <code>host</code> and <code>port</code>.
        </p>

        <p>
            You can test the connection by using telnet:
        </p>

        <pre><code>
$ telnet 127.0.0.1 10808
&gt; flush
1
&gt; close
$ ...
        </code></pre>

        <p>
            If you wish to connect from an application you need to connect to the
            Caphpe TCP socket using your language's features.
        </p>

        <h2 id="types-and-data">Types and data in Caphpe</h2>

        <p>
            Internally Caphpe data types and data storing itself is quite simple.
        </p>

        <h3 id="types-and-data/keys">Keys</h3>

        <p>
            All values in Caphpe are tied to a single key. Keys must be under 64
            characters long and can contain only the following characters:
        </p>

        <ul>
            <li><code>a-z</code> and <code>A-Z</code></li>
            <li><code>0-9</code></li>
            <li><code>.</code> and <code>_</code></li>
        </ul>

        <h3 id="types-and-data/types">Types</h3>

        <p>
            Internally Caphpe supports the following types: <code>string</code>,
            <code>integer</code> and <code>boolean</code>. All values are stored as
            strings unless otherwise instructed (or if PHP does some magic
            type-casting with no respect to the author).
        </p>

        <p>
            When issuing value-altering commands a user can tell Caphpe to cast to
            different types using the keys <code>s</code>, <code>i</code> and
            <code>b</code>. More on using those keys later when commands are
            explained.
        </p>

        <h3 id="types-and-data/values">Values</h3>

        <p>
            Each value is tied to a single key in Caphpe. Value can be one of the
            types mentioned above.
        </p>

        <p>
            Values currently have two restrictions:
        </p>

        <ul>
            <li>They cannot contain newlines (<code>\n</code>)</li>
            <li>They cannot end into an <code>&lt;space&gt;</code>+integer combination.</li>
        </ul>

        <p>
            Caphpe delimits commands using newlines (<code>\n</code>), so if there is
            one inside a value the commands breaks. Caphpe sets timeouts as the final
            command parameter so values ending in integers may not work properly.
        </p>

        <p>
            The following values would be OK
        </p>

        <pre><code>
this is an awesome value
this value is 100x awesomer
        </code></pre>

        <p>
            The following values may/will break
        </p>

        <pre><code>
this is some not cool value 12345
this is a naughty\nvalue which has a newline
        </code></pre>

        <p>
            Plans are in place to lift these restrictions, maybe by enforcing some
            delimiters around values for library/wrapper implementations.
        </p>

        <h3 id="types-and-data/timeouts">Timeouts</h3>

        <p>
            Each value in Caphpe has a timeout. A timeout internally is an absolute
            Unix timestamp which marks the time when a value is considered stale (and
            will be removed automatically from Caphpe).
        </p>

        <p>
            When giving timeout values, users must provide the timeout value as
            <em>seconds from now</em>. In other words how many seconds a value is
            considered "fresh".
        </p>

        <p>
            If no timeout value is given (or <code>0</code> is given) then Caphpe
            treats the value as "fresh forever" unless otherwise removed.
        </p>

        <h2 id="managing-data">Managing data in Caphpe</h2>

        <p>
            You can add, alter, fetch and delete data in Caphpe using the following
            commands.
        </p>

        <h3 id="managing-data/commands">Commands</h3>

        <div class="info">
            <strong>Legend</strong>:<br>
            <code>[]</code> denotes a parameter for a command,<br>
            <code>[]?</code> denotes an optional parameter.
        </div>

        <h4>add</h4>

        <pre><code>
<strong>add [key] [type]?[value] [timeout]?</strong>
    where
        [key] is a valid key
        [type] is one of
            s|
            i|
            b|
        [value] is a valid value
        [timeout] is an integer marking seconds
        </code></pre>

        <p>
            Add a value to Caphpe. If the key already exists this command does
            nothing. Examples:
        </p>

        <pre><code>
add mykey myvalue 3600
add mykey s|some string value
add mykey i|123456 3600
add mykey b|1 0
        </code></pre>

        <h4>set</h4>

        <pre><code>
<strong>set [key] [type]?[value] [timeout]?</strong>
    see add command for reference
        </code></pre>

        <p>
            Sets a value to Caphpe. Will create and override keys where needed.
            Examples:
        </p>

        <pre><code>
set mykey myvalue 3600
set mykey s|awesome string with awesome value
        </code></pre>

        <h4>replace</h4>

        <pre><code>
<strong>replace [key] [type]?[value] [timeout]?</strong>
    see add command for reference
        </code></pre>

        <p>
            Replaces a value in Caphpe. If the key does not exist this command does
            nothing. Examples:
        </p>

        <pre><code>
replace mykey myvalue 3600
replace mykey s|awesome string with awesome value
        </code></pre>

        <h4>delete</h4>

        <pre><code>
<strong>delete [key]</strong>
    where
        [key] is a valid key
        </code></pre>

        <p>
            Deletes a value from Caphpe. Does nothing if the key does not exist.
            Examples:
        </p>

        <pre><code>
delete mykey
        </code></pre>

        <h4>increment</h4>

        <pre><code>
<strong>increment [key] [timeout]?</strong>
    where
        [key] is a valid key
        [timeout] is an integer marking seconds
        </code></pre>

        <p>
            Increment a numeric value in Caphpe by <strong>1</strong>. If the value
            is not a numeric value or does not exist nothing is done. Examples:
        </p>

        <pre><code>
increment mykey 3600
increment somekey
        </code></pre>

        <h4>decrement</h4>

        <p>
            <em>See <code>increment</code>. This one does the opposite.</em>
        </p>

        <h4>has</h4>

        <pre><code>
<strong>has [key]</strong>
    where
        [key] is a valid key
        </code></pre>

        <p>
            Checks if a value exists for the given key. Returns <code>1</code> if does,
            empty value if not. Examples:
        </p>

        <pre><code>
has mykey
has someotherkey
        </code></pre>

        <h4>get</h4>

        <pre><code>
<strong>get [key]</strong>
    where
        [key] is a valid key
        </code></pre>

        <p>
            Get a value from Caphpe for a key. Returns the value or an empty string
            if no value exists for the key. Examples:
        </p>

        <pre><code>
get mykey
get somekey
        </code></pre>

        <h4>flush</h4>

        <pre><code>
<strong>flush</strong>
    (no parameters)
        </code></pre>

        <p>
            Flushes all data from Caphpe. Returns <code>1</code> if successful and an
            empty string if not. Example:
        </p>

        <pre><code>
flush
        </code></pre>

        <h4>status</h4>

        <pre><code>
<strong>status</strong>
    (no parameters)
        </code></pre>

        <p>
            Displays a status message. <strong>Note</strong>: Caphpe currently
            approximates memory usage per cache item, so there may be some error in
            the values returned by the status command.</p>

        <p>
            Here is an example output of the status command. Please note the separate
            header and value lines, with columns separated with a single
            <code>\t</code> character:
        </p>

        <pre><code>
Memory usage (MB)<em>\t</em>Item count<em>\t</em>Smallest item (KB)<em>\t</em>Largest item (KB)<em>\t</em>Average item (KB)
12.3456<em>\t</em>123<em>\t</em>0.704<em>\t</em>1.567<em>\t</em>0.888
        </code></pre>

        <p>
            Example:
        </p>

        <pre><code>
status
        </code></pre>

        <h2 id="issues-errors-bugs">Issues, errors and bugs</h2>

        <p>
            Currently Caphpe is in an unstable development phase. Bugs come and go
            and it may sometimes not work at all.
        </p>

        <p>
            If you encounter stuff that does not work as documented or does not work
            at all, please <a href="https://github.com/rask/caphpe">create an issue
            over at the GitHub issue tracker</a>.
        </p>

        <h3 id="issues-errors-bugs/known-issues">Known issues and limitations</h3>

        <ul>
            <li>
                There is currently no way to get a status report of sorts from Caphpe via the
                command API, e.g. memory usage, item count, key listing, etc.
            </li>
        </ul>

        <div class="footer">
            <p>Copyright &copy; Caphpe folks and contributors</p>
            <p><a href="#caphpe">Back to top</a></p>
            <p><a href="https://github.com/rask/caphpe">Caphpe @ GitHub</a></p>
        </div>

    </body>

</html>
